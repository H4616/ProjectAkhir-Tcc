steps:
  # Step 1: Membuat image Docker dari aplikasi backend
  - name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/$PROJECT_ID/tcc-be", "."]
    dir: "backend"  # Menentukan folder backend untuk proses build

  # Step 2: Meng-upload/push image Docker ke Artifact Registry
  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/$PROJECT_ID/tcc-be"]
    dir: "backend"  # Menentukan folder backend untuk proses push

  # Step 3: Melakukan deploy ke Cloud Run menggunakan image yang telah di-push
  - name: "gcr.io/cloud-builders/gcloud"
    args:
      [
        "run", "deploy", "be-tcc",
        "--image", "gcr.io/$PROJECT_ID/tcc-be",
        "--timeout", "3000s",
        "--port", "5000",
        "--region", "us-central1",
        "--allow-unauthenticated"
      ]
    dir: "backend"  # Menentukan folder backend untuk menjalankan gcloud deploy

options:
  logging: CLOUD_LOGGING_ONLY
